ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"bsp_f1xx_dma.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.getdmax,"ax",%progbits
  16              		.align	1
  17              		.global	getdmax
  18              		.syntax unified
  19              		.thumb
  20              		.thumb_func
  21              		.fpu softvfp
  23              	getdmax:
  24              	.LFB66:
  25              		.file 1 "drivers/bsp_f1xx_dma.c"
   1:drivers/bsp_f1xx_dma.c **** //
   2:drivers/bsp_f1xx_dma.c **** // Created by 周洋 on 2020/3/29.
   3:drivers/bsp_f1xx_dma.c **** //
   4:drivers/bsp_f1xx_dma.c **** 
   5:drivers/bsp_f1xx_dma.c **** #include "bsp_f1xx_dma.h"
   6:drivers/bsp_f1xx_dma.c **** 
   7:drivers/bsp_f1xx_dma.c **** DMA_TypeDef *getdmax(DMA_Channel_TypeDef *chx)
   8:drivers/bsp_f1xx_dma.c **** {
  26              		.loc 1 8 0
  27              		.cfi_startproc
  28              		@ args = 0, pretend = 0, frame = 0
  29              		@ frame_needed = 0, uses_anonymous_args = 0
  30              		@ link register save eliminated.
  31              	.LVL0:
   9:drivers/bsp_f1xx_dma.c **** 	if (chx > DMA2_Channel1)
  32              		.loc 1 9 0
  33 0000 034B     		ldr	r3, .L5
  34 0002 9842     		cmp	r0, r3
  35 0004 01D8     		bhi	.L4
  10:drivers/bsp_f1xx_dma.c **** 		return DMA2;
  11:drivers/bsp_f1xx_dma.c **** 	else
  12:drivers/bsp_f1xx_dma.c **** 		return DMA1;
  36              		.loc 1 12 0
  37 0006 0348     		ldr	r0, .L5+4
  38              	.LVL1:
  13:drivers/bsp_f1xx_dma.c **** }
  39              		.loc 1 13 0
  40 0008 7047     		bx	lr
  41              	.LVL2:
  42              	.L4:
  10:drivers/bsp_f1xx_dma.c **** 		return DMA2;
  43              		.loc 1 10 0
  44 000a 0348     		ldr	r0, .L5+8
ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 2


  45              	.LVL3:
  46 000c 7047     		bx	lr
  47              	.L6:
  48 000e 00BF     		.align	2
  49              	.L5:
  50 0010 08040240 		.word	1073873928
  51 0014 00000240 		.word	1073872896
  52 0018 00040240 		.word	1073873920
  53              		.cfi_endproc
  54              	.LFE66:
  56              		.section	.text.dmainit,"ax",%progbits
  57              		.align	1
  58              		.global	dmainit
  59              		.syntax unified
  60              		.thumb
  61              		.thumb_func
  62              		.fpu softvfp
  64              	dmainit:
  65              	.LFB67:
  14:drivers/bsp_f1xx_dma.c **** 
  15:drivers/bsp_f1xx_dma.c **** //DMA1的各通道配置
  16:drivers/bsp_f1xx_dma.c **** //这里的传输形式是固定的,这点要根据不同的情况来修改
  17:drivers/bsp_f1xx_dma.c **** //从存储器->外设模式/8位数据宽度/存储器增量模式
  18:drivers/bsp_f1xx_dma.c **** //DMA_CHx:DMA通道CHx
  19:drivers/bsp_f1xx_dma.c **** //cpar:外设地址
  20:drivers/bsp_f1xx_dma.c **** //cmar:存储器地址
  21:drivers/bsp_f1xx_dma.c **** //cndtr:数据传输量
  22:drivers/bsp_f1xx_dma.c **** void dmainit(DMA_Channel_TypeDef *DMA_CHx, u32 cpar, u32 cmar, u8 dir)
  23:drivers/bsp_f1xx_dma.c **** {
  66              		.loc 1 23 0
  67              		.cfi_startproc
  68              		@ args = 0, pretend = 0, frame = 0
  69              		@ frame_needed = 0, uses_anonymous_args = 0
  70              		@ link register save eliminated.
  71              	.LVL4:
  72 0000 30B4     		push	{r4, r5}
  73              	.LCFI0:
  74              		.cfi_def_cfa_offset 8
  75              		.cfi_offset 4, -8
  76              		.cfi_offset 5, -4
  24:drivers/bsp_f1xx_dma.c **** 	if (DMA_CHx >= DMA2_Channel1) {
  77              		.loc 1 24 0
  78 0002 1A4C     		ldr	r4, .L13
  79 0004 A042     		cmp	r0, r4
  80 0006 25D9     		bls	.L8
  25:drivers/bsp_f1xx_dma.c **** 		RCC->AHBENR |= 0x02;
  81              		.loc 1 25 0
  82 0008 194D     		ldr	r5, .L13+4
  83 000a 6C69     		ldr	r4, [r5, #20]
  84 000c 44F00204 		orr	r4, r4, #2
  85 0010 6C61     		str	r4, [r5, #20]
  86              	.L9:
  26:drivers/bsp_f1xx_dma.c **** 		while (!(RCC->AHBENR & 0x02));
  87              		.loc 1 26 0 discriminator 1
  88 0012 174C     		ldr	r4, .L13+4
  89 0014 6469     		ldr	r4, [r4, #20]
  90 0016 14F0020F 		tst	r4, #2
ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 3


  91 001a FAD0     		beq	.L9
  92              	.L10:
  27:drivers/bsp_f1xx_dma.c **** 	} else {
  28:drivers/bsp_f1xx_dma.c **** 		RCC->AHBENR |= 0x01;
  29:drivers/bsp_f1xx_dma.c **** 		while (!(RCC->AHBENR & 0x01));
  30:drivers/bsp_f1xx_dma.c **** 	}
  31:drivers/bsp_f1xx_dma.c **** 
  32:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CPAR = cpar;      //DMA1 外设地址
  93              		.loc 1 32 0
  94 001c 8160     		str	r1, [r0, #8]
  33:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CMAR = (u32) cmar; //DMA1,存储器地址
  95              		.loc 1 33 0
  96 001e C260     		str	r2, [r0, #12]
  34:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR = 0X00000000; //复位
  97              		.loc 1 34 0
  98 0020 0022     		movs	r2, #0
  99              	.LVL5:
 100 0022 0260     		str	r2, [r0]
 101              	.LVL6:
  35:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= dir << 4;    //从存储器读
 102              		.loc 1 35 0
 103 0024 0268     		ldr	r2, [r0]
 104 0026 42EA0313 		orr	r3, r2, r3, lsl #4
 105              	.LVL7:
 106 002a 0360     		str	r3, [r0]
  36:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 0 << 5;    //普通模式
 107              		.loc 1 36 0
 108 002c 0368     		ldr	r3, [r0]
 109 002e 0360     		str	r3, [r0]
  37:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 0 << 6;    //外设地址非增量模式
 110              		.loc 1 37 0
 111 0030 0368     		ldr	r3, [r0]
 112 0032 0360     		str	r3, [r0]
  38:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 1 << 7;    //存储器增量模式
 113              		.loc 1 38 0
 114 0034 0368     		ldr	r3, [r0]
 115 0036 43F08003 		orr	r3, r3, #128
 116 003a 0360     		str	r3, [r0]
  39:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 0 << 8;    //外设数据宽度为8位
 117              		.loc 1 39 0
 118 003c 0368     		ldr	r3, [r0]
 119 003e 0360     		str	r3, [r0]
  40:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 0 << 10;   //存储器数据宽度8位
 120              		.loc 1 40 0
 121 0040 0368     		ldr	r3, [r0]
 122 0042 0360     		str	r3, [r0]
  41:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 1 << 12;   //中等优先级
 123              		.loc 1 41 0
 124 0044 0368     		ldr	r3, [r0]
 125 0046 43F48053 		orr	r3, r3, #4096
 126 004a 0360     		str	r3, [r0]
  42:drivers/bsp_f1xx_dma.c **** 	DMA_CHx->CCR |= 0 << 14;   //非存储器到存储器模式
 127              		.loc 1 42 0
 128 004c 0368     		ldr	r3, [r0]
 129 004e 0360     		str	r3, [r0]
  43:drivers/bsp_f1xx_dma.c **** }
 130              		.loc 1 43 0
ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 4


 131 0050 30BC     		pop	{r4, r5}
 132              	.LCFI1:
 133              		.cfi_remember_state
 134              		.cfi_restore 5
 135              		.cfi_restore 4
 136              		.cfi_def_cfa_offset 0
 137 0052 7047     		bx	lr
 138              	.LVL8:
 139              	.L8:
 140              	.LCFI2:
 141              		.cfi_restore_state
  28:drivers/bsp_f1xx_dma.c **** 		while (!(RCC->AHBENR & 0x01));
 142              		.loc 1 28 0
 143 0054 064D     		ldr	r5, .L13+4
 144 0056 6C69     		ldr	r4, [r5, #20]
 145 0058 44F00104 		orr	r4, r4, #1
 146 005c 6C61     		str	r4, [r5, #20]
 147              	.L11:
  29:drivers/bsp_f1xx_dma.c **** 	}
 148              		.loc 1 29 0 discriminator 1
 149 005e 044C     		ldr	r4, .L13+4
 150 0060 6469     		ldr	r4, [r4, #20]
 151 0062 14F0010F 		tst	r4, #1
 152 0066 FAD0     		beq	.L11
 153 0068 D8E7     		b	.L10
 154              	.L14:
 155 006a 00BF     		.align	2
 156              	.L13:
 157 006c 07040240 		.word	1073873927
 158 0070 00100240 		.word	1073876992
 159              		.cfi_endproc
 160              	.LFE67:
 162              		.section	.text.dma_stream_en,"ax",%progbits
 163              		.align	1
 164              		.global	dma_stream_en
 165              		.syntax unified
 166              		.thumb
 167              		.thumb_func
 168              		.fpu softvfp
 170              	dma_stream_en:
 171              	.LFB68:
  44:drivers/bsp_f1xx_dma.c **** 
  45:drivers/bsp_f1xx_dma.c **** //开启一次DMA传输
  46:drivers/bsp_f1xx_dma.c **** void dma_stream_en(DMA_Channel_TypeDef *chx, u8 *buf, u16 len)
  47:drivers/bsp_f1xx_dma.c **** {
 172              		.loc 1 47 0
 173              		.cfi_startproc
 174              		@ args = 0, pretend = 0, frame = 0
 175              		@ frame_needed = 0, uses_anonymous_args = 0
 176              		@ link register save eliminated.
 177              	.LVL9:
  48:drivers/bsp_f1xx_dma.c **** 	chx->CCR &= ~(1 << 0);     //关闭DMA传输
 178              		.loc 1 48 0
 179 0000 0368     		ldr	r3, [r0]
 180 0002 23F00103 		bic	r3, r3, #1
 181 0006 0360     		str	r3, [r0]
  49:drivers/bsp_f1xx_dma.c **** 	chx->CMAR = (u32) &buf[0];
ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 5


 182              		.loc 1 49 0
 183 0008 C160     		str	r1, [r0, #12]
  50:drivers/bsp_f1xx_dma.c **** 	chx->CNDTR = len;
 184              		.loc 1 50 0
 185 000a 4260     		str	r2, [r0, #4]
  51:drivers/bsp_f1xx_dma.c **** 	chx->CCR |= 1 << 0;           //开启DMA传输
 186              		.loc 1 51 0
 187 000c 0368     		ldr	r3, [r0]
 188 000e 43F00103 		orr	r3, r3, #1
 189 0012 0360     		str	r3, [r0]
  52:drivers/bsp_f1xx_dma.c **** }
 190              		.loc 1 52 0
 191 0014 7047     		bx	lr
 192              		.cfi_endproc
 193              	.LFE68:
 195              		.section	.text.dma_clear_flag,"ax",%progbits
 196              		.align	1
 197              		.global	dma_clear_flag
 198              		.syntax unified
 199              		.thumb
 200              		.thumb_func
 201              		.fpu softvfp
 203              	dma_clear_flag:
 204              	.LFB69:
  53:drivers/bsp_f1xx_dma.c **** 
  54:drivers/bsp_f1xx_dma.c **** void dma_clear_flag(DMA_Channel_TypeDef *chx)
  55:drivers/bsp_f1xx_dma.c **** {
 205              		.loc 1 55 0
 206              		.cfi_startproc
 207              		@ args = 0, pretend = 0, frame = 0
 208              		@ frame_needed = 0, uses_anonymous_args = 0
 209              	.LVL10:
 210 0000 10B5     		push	{r4, lr}
 211              	.LCFI3:
 212              		.cfi_def_cfa_offset 8
 213              		.cfi_offset 4, -8
 214              		.cfi_offset 14, -4
 215 0002 0446     		mov	r4, r0
  56:drivers/bsp_f1xx_dma.c **** 	DMA_TypeDef *dmax = getdmax(chx);
 216              		.loc 1 56 0
 217 0004 FFF7FEFF 		bl	getdmax
 218              	.LVL11:
  57:drivers/bsp_f1xx_dma.c **** 	if (dmax == DMA1)
 219              		.loc 1 57 0
 220 0008 0D4B     		ldr	r3, .L21
 221 000a 9842     		cmp	r0, r3
 222 000c 0BD0     		beq	.L20
  58:drivers/bsp_f1xx_dma.c **** 		dmax->IFCR = (u32) 0x0F << ((((u32) chx - DMA1_Channel1_BASE) / 0x14) << 2);
  59:drivers/bsp_f1xx_dma.c **** 	else
  60:drivers/bsp_f1xx_dma.c **** 		dmax->IFCR = (u32) 0x0F << ((((u32) chx - DMA2_Channel1_BASE) / 0x14) << 2);
 223              		.loc 1 60 0
 224 000e 0D4B     		ldr	r3, .L21+4
 225 0010 2344     		add	r3, r3, r4
 226 0012 0D4A     		ldr	r2, .L21+8
 227 0014 A2FB0323 		umull	r2, r3, r2, r3
 228 0018 1B09     		lsrs	r3, r3, #4
 229 001a 9B00     		lsls	r3, r3, #2
ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 6


 230 001c 0F22     		movs	r2, #15
 231 001e 02FA03F3 		lsl	r3, r2, r3
 232 0022 4360     		str	r3, [r0, #4]
 233              	.L16:
  61:drivers/bsp_f1xx_dma.c **** }
 234              		.loc 1 61 0
 235 0024 10BD     		pop	{r4, pc}
 236              	.LVL12:
 237              	.L20:
  58:drivers/bsp_f1xx_dma.c **** 		dmax->IFCR = (u32) 0x0F << ((((u32) chx - DMA1_Channel1_BASE) / 0x14) << 2);
 238              		.loc 1 58 0
 239 0026 094B     		ldr	r3, .L21+12
 240 0028 2344     		add	r3, r3, r4
 241 002a 074A     		ldr	r2, .L21+8
 242 002c A2FB0323 		umull	r2, r3, r2, r3
 243 0030 1B09     		lsrs	r3, r3, #4
 244 0032 9B00     		lsls	r3, r3, #2
 245 0034 0F22     		movs	r2, #15
 246 0036 02FA03F3 		lsl	r3, r2, r3
 247 003a 4360     		str	r3, [r0, #4]
 248 003c F2E7     		b	.L16
 249              	.L22:
 250 003e 00BF     		.align	2
 251              	.L21:
 252 0040 00000240 		.word	1073872896
 253 0044 F8FBFDBF 		.word	-1073873928
 254 0048 CDCCCCCC 		.word	-858993459
 255 004c F8FFFDBF 		.word	-1073872904
 256              		.cfi_endproc
 257              	.LFE69:
 259              		.text
 260              	.Letext0:
 261              		.file 2 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-9-2019-q4-major/arm-none-eabi/include/machine/_
 262              		.file 3 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-9-2019-q4-major/arm-none-eabi/include/sys/lock.
 263              		.file 4 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-9-2019-q4-major/arm-none-eabi/include/sys/_type
 264              		.file 5 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-7-2017-q4-major/lib/gcc/arm-none-eabi/7.2.1/inc
 265              		.file 6 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-9-2019-q4-major/arm-none-eabi/include/sys/reent
 266              		.file 7 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-9-2019-q4-major/arm-none-eabi/include/sys/_stdi
 267              		.file 8 "/Users/zy/Desktop/Tools/gcc-arm-none-eabi-9-2019-q4-major/arm-none-eabi/include/stdlib.h"
 268              		.file 9 "Inc/core_cm3.h"
 269              		.file 10 "Inc/stm32f103xe.h"
 270              		.file 11 "startup/inc/sys.h"
 271              		.file 12 "tools/inc/malloc.h"
 272              		.file 13 "tools/inc/tskmanager.h"
ARM GAS  /var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s 			page 7


DEFINED SYMBOLS
                            *ABS*:0000000000000000 bsp_f1xx_dma.c
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:16     .text.getdmax:0000000000000000 $t
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:23     .text.getdmax:0000000000000000 getdmax
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:50     .text.getdmax:0000000000000010 $d
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:57     .text.dmainit:0000000000000000 $t
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:64     .text.dmainit:0000000000000000 dmainit
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:157    .text.dmainit:000000000000006c $d
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:163    .text.dma_stream_en:0000000000000000 $t
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:170    .text.dma_stream_en:0000000000000000 dma_stream_en
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:196    .text.dma_clear_flag:0000000000000000 $t
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:203    .text.dma_clear_flag:0000000000000000 dma_clear_flag
/var/folders/vc/p32jbmgs3k17njj5gy_2_k3w0000gn/T//ccAoMCnx.s:252    .text.dma_clear_flag:0000000000000040 $d

NO UNDEFINED SYMBOLS
